<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="小程序," />










<meta name="description" content="微信小程序由于适用性强、逻辑简要、开发迅速的特性，叠加具有海量活跃用户的腾讯公司背景，逐渐成为了轻量级单一功能应用场景的较佳承载方式，诸如电影购票、外卖点餐、移动商城、生活服务等场景服务提供商迅速切入了。 为了贴合实际的应用情况，本篇以豆瓣评分小程序为参考样例，边做边学小程序的入门开发知识。">
<meta name="keywords" content="小程序">
<meta property="og:type" content="article">
<meta property="og:title" content="边做边学入门微信小程序之仿豆瓣评分（下）">
<meta property="og:url" content="/2018/03/22/边做边学入门微信小程序之仿豆瓣评分：下/index.html">
<meta property="og:site_name" content="纯文笔记">
<meta property="og:description" content="微信小程序由于适用性强、逻辑简要、开发迅速的特性，叠加具有海量活跃用户的腾讯公司背景，逐渐成为了轻量级单一功能应用场景的较佳承载方式，诸如电影购票、外卖点餐、移动商城、生活服务等场景服务提供商迅速切入了。 为了贴合实际的应用情况，本篇以豆瓣评分小程序为参考样例，边做边学小程序的入门开发知识。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="/2018/03/22/边做边学入门微信小程序之仿豆瓣评分：下/边做边学入门微信小程序之仿豆瓣评分：下/miniprogram_01.jpg">
<meta property="og:image" content="/2018/03/22/边做边学入门微信小程序之仿豆瓣评分：下/边做边学入门微信小程序之仿豆瓣评分：下/miniprogram_02.jpg">
<meta property="og:image" content="/2018/03/22/边做边学入门微信小程序之仿豆瓣评分：下/边做边学入门微信小程序之仿豆瓣评分：下/miniprogram_03.jpg">
<meta property="og:image" content="/2018/03/22/边做边学入门微信小程序之仿豆瓣评分：下/边做边学入门微信小程序之仿豆瓣评分：下/mediaplatform.jpg">
<meta property="og:updated_time" content="2018-06-02T22:43:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="边做边学入门微信小程序之仿豆瓣评分（下）">
<meta name="twitter:description" content="微信小程序由于适用性强、逻辑简要、开发迅速的特性，叠加具有海量活跃用户的腾讯公司背景，逐渐成为了轻量级单一功能应用场景的较佳承载方式，诸如电影购票、外卖点餐、移动商城、生活服务等场景服务提供商迅速切入了。 为了贴合实际的应用情况，本篇以豆瓣评分小程序为参考样例，边做边学小程序的入门开发知识。">
<meta name="twitter:image" content="/2018/03/22/边做边学入门微信小程序之仿豆瓣评分：下/边做边学入门微信小程序之仿豆瓣评分：下/miniprogram_01.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="/2018/03/22/边做边学入门微信小程序之仿豆瓣评分：下/"/>





  <title>边做边学入门微信小程序之仿豆瓣评分（下） | 纯文笔记</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">纯文笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录知识，分享心得。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="/2018/03/22/边做边学入门微信小程序之仿豆瓣评分：下/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="徐纯文">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="纯文笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">边做边学入门微信小程序之仿豆瓣评分（下）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-22T19:32:59+08:00">
                2018-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/小程序/" itemprop="url" rel="index">
                    <span itemprop="name">小程序</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>微信小程序由于适用性强、逻辑简要、开发迅速的特性，叠加具有海量活跃用户的腾讯公司背景，逐渐成为了轻量级单一功能应用场景的较佳承载方式，诸如电影购票、外卖点餐、移动商城、生活服务等场景服务提供商迅速切入了。</p>
<p>为了贴合实际的应用情况，本篇以豆瓣评分小程序为参考样例，边做边学小程序的入门开发知识。</p>
<a id="more"></a>
<p><strong>目录</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">效果图</span><br><span class="line">Demo源码</span><br><span class="line">开发环境</span><br><span class="line">了解官方样例</span><br><span class="line">    开发者工具</span><br><span class="line">    样例源码结构</span><br><span class="line">开发实战</span><br><span class="line">    底部Tab卡页</span><br><span class="line">    分析开发需求</span><br><span class="line">    评分条模板</span><br><span class="line">        rpx长度单位</span><br><span class="line">        数据绑定</span><br><span class="line">        条件渲染</span><br><span class="line">        列表渲染</span><br><span class="line">    电影海报模板</span><br><span class="line">        模板的使用</span><br><span class="line">    区块模板</span><br><span class="line">    主页</span><br><span class="line">        网络请求</span><br><span class="line">        逻辑实现</span><br><span class="line">        setData</span><br><span class="line">        点击事件</span><br><span class="line">    详情页</span><br><span class="line">    更多页</span><br><span class="line">扩展知识</span><br><span class="line">思考题</span><br></pre></td></tr></table></figure>
<h4 id="主页"><a href="#主页" class="headerlink" title="主页"></a>主页</h4><p>首先是index.wxss文件，一行代码导入block模板的wxss：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pages/movies/index.wxss */</span></span><br><span class="line"><span class="comment">/* 导入block模板的wxss */</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"block/block.wxss"</span>;</span><br></pre></td></tr></table></figure>
<p>然后是index.wxml文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/movies/index.wxml--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--导入block区块模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">"../block/block.wxml"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--for循环取出三个区块的数据，填入模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;threeBlockInfo&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"blockInfo"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">"template-block"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;...blockInfo&#125;&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这是首页作为静态页面的全部代码，通过导入block模板，在for循环中取出“正在热映”、“即将上映”和“排行榜”三个区块的数据，散开传入模板即可。</p>
<p>threeBlockInfo是我们在index.js文件的data中自定义的数组变量名，用来存放三个区块的标题和滑动条中的电影信息。这个数据是通过请求网络动态加载的。</p>
<h5 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h5><p>接下来我们先看看小程序的网络请求相关的知识。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wx.request(&#123;</span><br><span class="line">    url: yourUrl,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      <span class="comment">//网络请求成功后的回调</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>wx.request()是小程序官方封装的网络请求API，它有诸多的其它的参数，这里我们只用了最简要的参数，url表示你要请求的网址，success表示请求成功后的回调（为简便，这里忽略fail等情况）。</p>
<p>小程序中有多处地方需要用到网络请求，因此我们将这个网络请求简单的封装一下，以便多处调用。</p>
<p>在utils目录下新建httpUtil.js文件，并写入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 常规请求</span></span><br><span class="line"><span class="comment"> * url 请求网址</span></span><br><span class="line"><span class="comment"> * successCallback 请求成功后的回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url, successCallback</span>)</span>&#123;</span><br><span class="line">  wx.request(&#123;</span><br><span class="line">    url: url,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      successCallback(res.data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 正在热映、即将上映和排行榜的网络请求，</span></span><br><span class="line"><span class="comment"> * 传入key和title用以在回调中区分对应区块</span></span><br><span class="line"><span class="comment"> * url 请求网址</span></span><br><span class="line"><span class="comment"> * key 区分区块的key</span></span><br><span class="line"><span class="comment"> * title 区块标题</span></span><br><span class="line"><span class="comment"> * successCallback 请求成功后的回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestBlockMovies</span>(<span class="params">url, key, title, successCallback</span>) </span>&#123;</span><br><span class="line">  wx.request(&#123;</span><br><span class="line">    url: url,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      successCallback(res.data, key, title);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//向外暴露方法名</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  request:request,</span><br><span class="line">  requestBlockMovies: requestBlockMovies</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里封装了2个网络请求方法，一个是常规请求，一个是三个区块的请求（通过传入不同的key来识别对应的区块，以便在回调中存储返回值到对方的变量中，可能暂时不好理解，稍后看后文的用法一看并知）。</p>
<p>通过module.exports向外暴露方法名，并在需要使用的文件中导入本js文件，方可调用到这2个方法。</p>
<p>另外在utils目录中新建一个stringUtils.js文件，这是一个工具类，处理电影名称过长等情况，可以不必理解代码含义，复制过去即可。代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理电影名称过长的问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processTitle</span>(<span class="params">subjects, count</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> subjects) &#123;</span><br><span class="line">    <span class="comment">//电影名称</span></span><br><span class="line">    <span class="keyword">var</span> title = subjects[i].title;</span><br><span class="line">    <span class="comment">//名称中第一个空格的位置</span></span><br><span class="line">    <span class="keyword">var</span> index = <span class="keyword">this</span>.getTitleSeparateIndex(title);</span><br><span class="line">    <span class="comment">//取出电影名称中的首位名称/中文名称，如《泰坦尼克号 Titanic》，通常为中外文以空格间隔</span></span><br><span class="line">    title = <span class="keyword">this</span>.getChineseTitle(title, index);</span><br><span class="line">    <span class="comment">//如果首位名称超过7个字，则缩略为...</span></span><br><span class="line">    title = <span class="keyword">this</span>.substringTitle(title, count);</span><br><span class="line">    subjects[i].title = title;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取电影名称的分割位置（电影名称通常由中外文组成并以空格分隔）</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTitleSeparateIndex</span>(<span class="params">title</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (title == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> title.indexOf(<span class="string">" "</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取电影中文名称/第一个空格前的名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getChineseTitle</span> (<span class="params">title, index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> title.substring(<span class="number">0</span>, index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取电影外文名称/第一个空格后的名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getForeignTitle</span> (<span class="params">title, index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> length = title.lenght;</span><br><span class="line">  <span class="keyword">return</span> title.substring(index + <span class="number">1</span>, length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定长度，截取电影名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">substringTitle</span> (<span class="params">title, count</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (title.length &lt;= count) &#123;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> title.substring(<span class="number">0</span>, count) + <span class="string">"..."</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用“ / ”拼接数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jointWithSlash</span> (<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> array) &#123;</span><br><span class="line">    str += array[i] + <span class="string">" / "</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//去除末位的“/ ”符号（斜杠后有个空格，共2位）</span></span><br><span class="line">  <span class="keyword">return</span> str = str.substring(<span class="number">0</span>, str.length - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取出演员的姓名组成一个数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCastsNameArr</span> (<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> array) &#123;</span><br><span class="line">    arr[i] = array[i].name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在第一个名字后插入“（导演）”字符</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insertDirectorText</span> (<span class="params">str, insertWord</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"insertDirectorText "</span> + str)</span><br><span class="line">  <span class="keyword">var</span> index = str.indexOf(<span class="string">" / "</span>);</span><br><span class="line">  <span class="keyword">var</span> director = str.substring(<span class="number">0</span>, index) + insertWord;</span><br><span class="line">  <span class="keyword">var</span> casts = str.substring(index, str.length);</span><br><span class="line">  <span class="keyword">return</span> director.concat(casts);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将“\\n”转为“\n”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceSlashN</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/\r?\\n/g</span>, <span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//向外暴露方法名</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  processTitle: processTitle,</span><br><span class="line">  getTitleSeparateIndex: getTitleSeparateIndex,</span><br><span class="line">  getChineseTitle: getChineseTitle,</span><br><span class="line">  getForeignTitle: getForeignTitle,</span><br><span class="line">  substringTitle: substringTitle,</span><br><span class="line">  jointWithSlash: jointWithSlash,</span><br><span class="line">  getCastsNameArr: getCastsNameArr,</span><br><span class="line">  insertDirectorText: insertDirectorText,</span><br><span class="line">  replaceSlashN: replaceSlashN</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打开app.js文件，定义一个全局变量baseUrl，值为接口的基本网址。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">  <span class="comment">//全局数据</span></span><br><span class="line">  globalData:&#123;</span><br><span class="line">    <span class="comment">//基本网址</span></span><br><span class="line">    baseUrl:<span class="string">"http://t.yushu.im"</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>注意，app.js最外层为App({})，各个页面的js文件是Page({})。</p>
<p>因豆瓣近期关闭了面向个人开发者的API接口功能，本篇目前采用一家第三方接口(t.yushu.im)提供的数据，其并未提供搜索功能的接口，因此暂时无法实现官方小程序中含有的搜索功能。</p>
<p><img src="边做边学入门微信小程序之仿豆瓣评分：下/miniprogram_01.jpg" alt="img"></p>
<p>Tips：第三方接口仅供学习使用，请勿滥用；并且可能随时停止服务，请勿用在正式产品中。</p>
<p>因为小程序要求网络请求的域名必须为https安全链接，这里开发用的接口网址没有https证书，因此需要点击开发者工具顶端的菜单“设置”—“项目设置”，勾选“不校验安全域名”项。但是，正式发布的小程序所使用的网络请求中，接口网址必须为https类型。</p>
<p><img src="边做边学入门微信小程序之仿豆瓣评分：下/miniprogram_02.jpg" alt="img"></p>
<h5 id="逻辑实现"><a href="#逻辑实现" class="headerlink" title="逻辑实现"></a>逻辑实现</h5><p>在index.js文件开头写入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/movies/index/index.js</span></span><br><span class="line"><span class="comment">/* 导入网络请求工具类 */</span></span><br><span class="line"><span class="keyword">var</span> httpUtil = <span class="built_in">require</span>(<span class="string">'../../utils/httpUtil.js'</span>);</span><br><span class="line"><span class="comment">/* 导入字符处理工具类 */</span></span><br><span class="line"><span class="keyword">var</span> stringUtil = <span class="built_in">require</span>(<span class="string">'../../utils/stringUtil.js'</span>);</span><br><span class="line"><span class="comment">/* 获取App对象 */</span></span><br><span class="line"><span class="keyword">var</span> app = getApp();</span><br><span class="line">Page(&#123;</span><br><span class="line">  ……</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在这里导入了网络请求和字符处理工具类，这样就可以调用工具类中module.exports向下暴露的方法。通过系统提供的getApp()方法获得APP实例app，之后可以用app调用APP的相关方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    <span class="comment">//存储从三个区块的数据</span></span><br><span class="line">    threeBlockInfo: &#123;</span><br><span class="line">      hot: &#123;&#125;,<span class="comment">//正在热映</span></span><br><span class="line">      recent: &#123;&#125;,<span class="comment">//即将上映</span></span><br><span class="line">      top250: &#123;&#125; <span class="comment">//排行榜</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ……</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在data中定义一个变量threeBlockInfo，内含三个空键值对，用来存放首页三个区块网络请求后的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    ……</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 本页面第一次加载时调用</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//基本网址</span></span><br><span class="line">    <span class="keyword">var</span> baseUrl = app.globalData.baseUrl;</span><br><span class="line">    <span class="comment">//起止条数，获取头7条</span></span><br><span class="line">    <span class="keyword">var</span> startAndCount = <span class="string">"?start=0&amp;count=7"</span>;</span><br><span class="line">    <span class="comment">//正在热映网址</span></span><br><span class="line">    <span class="keyword">var</span> hotUrl = baseUrl + <span class="string">"/v2/movie/in_theaters"</span> + startAndCount;</span><br><span class="line">    <span class="comment">//即将上映网址</span></span><br><span class="line">    <span class="keyword">var</span> recentUrl = baseUrl + <span class="string">"/v2/movie/coming_soon"</span> + startAndCount;</span><br><span class="line">    <span class="comment">//排行榜数据网址</span></span><br><span class="line">    <span class="keyword">var</span> top250Url = baseUrl + <span class="string">"/v2/movie/top250"</span> + startAndCount;</span><br><span class="line">    <span class="comment">//获取正在热映电影数据</span></span><br><span class="line">    httpUtil.requestBlockMovies(hotUrl, <span class="string">"hot"</span>, <span class="string">"正在热映"</span>, <span class="keyword">this</span>.processResult);</span><br><span class="line">    <span class="comment">//获取即将上映电影数据</span></span><br><span class="line">    httpUtil.requestBlockMovies(recentUrl, <span class="string">"recent"</span>, <span class="string">"即将上映"</span>, <span class="keyword">this</span>.processResult);</span><br><span class="line">    <span class="comment">//获取排行版电影数据</span></span><br><span class="line">    httpUtil.requestBlockMovies(top250Url, <span class="string">"top250"</span>, <span class="string">"排行榜"</span>, <span class="keyword">this</span>.processResult);</span><br><span class="line">  &#125;,</span><br><span class="line">  ……</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>小程序每个页面存在着生命周期，例如页面首页加载时会触发onLoad(options)方法，在这里我们可以做网络请求的工作。</p>
<p>首先通过APP实例app获取到app.js文件中globalData里定义的基本网址，然后拼接出三个区块的接口网址。</p>
<p>通过网络请求工具类中向外暴露的方法去获取三个区块的数据。如果请求成功，将回调processResult()方法，我们在后面继续实现这个回调方法。（这里仅作演示用，未对请求不成功等情形做分支处理，可根据业务自行处理逻辑。）</p>
<p>这里我们先后发起了三次请求，分别去获取对应的数据，但回调未必会按顺序返回，可能后发起的请求先返回数据。如何在回调中区分是哪个区块的数据呢？这里传入的第二个参数key分别为hot/recent/top250，便是识别标识，用途看下文。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    ……</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取电影数据的success回调函数，在此处理请求到的数据</span></span><br><span class="line"><span class="comment">   * result 请求结果</span></span><br><span class="line"><span class="comment">   * key 存储结果到哪个key值</span></span><br><span class="line"><span class="comment">   * blockTitle 区块标题</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  processResult: <span class="function"><span class="keyword">function</span> (<span class="params">result, key, blockTitle</span>) </span>&#123;</span><br><span class="line">     <span class="comment">//打印请求到的结果</span></span><br><span class="line">    <span class="built_in">console</span>.log(result.subjects)</span><br><span class="line">    <span class="comment">//处理电影名称过长的问题，截取前8位</span></span><br><span class="line">    stringUtil.processTitle(result.subjects, <span class="number">8</span>);</span><br><span class="line">    <span class="comment">//将处理过的结果放入threeBlockInfo中</span></span><br><span class="line">    <span class="keyword">this</span>.data.threeBlockInfo[key] = &#123;</span><br><span class="line">      blockTitle: blockTitle,</span><br><span class="line">      blockMovies: result</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新threeBlockInfo数据</span></span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      threeBlockInfo: <span class="keyword">this</span>.data.threeBlockInfo</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>请求数据成功后，将对应的数据和其标题存入对应的threeBlockInfo[key]中。例如排行榜top250的数据和标题“排行榜”，将存入threeBlockInfo[top250]中，键名分别是blockMovies和blockTitle，如此，三个区块的数据无论哪个请求先返回数据，都会存入对应的键值对中，互不影响，同时保证了threeBlockInfo本身是有序的。</p>
<h5 id="setData"><a href="#setData" class="headerlink" title="setData"></a>setData</h5><p>然后，通过this.setData的方式，将threeBlockInfo的数据更新并重新渲染界面。</p>
<p>注意：小程序官方警告不要用“=”号赋值，这样并不会重新渲染界面，会导致用户在前台看到的数据和实际内存中的数据不一致。因为渲染界面属于耗时操作，不要频繁地setData，当页面在后台时，也没必要setData。</p>
<p>接下来，我们实现电影详情页。当我们在首页点击某个电影海报时，可以跳转到这部电影的详情页。我们来看获取电影详情页的接口网址。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//接口</span><br><span class="line">http://t.yushu.im/v2/movie/subject/:id</span><br><span class="line">//示例</span><br><span class="line">http://t.yushu.im/v2/movie/subject/6</span><br></pre></td></tr></table></figure>
<p>显然，当我们点击首页电影时，要将点击的电影的id带到详情页，这样详情页才知道去请求哪部电影的数据。</p>
<p>那么，如何将数据带过去呢？</p>
<h5 id="点击事件"><a href="#点击事件" class="headerlink" title="点击事件"></a>点击事件</h5><p>我们回到poster.wxml中，在这个海报模板里，曾经有一行代码我们还没有讲解，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'movie'</span> <span class="attr">catchtap</span>=<span class="string">'catchTapMovie'</span> <span class="attr">data-movieid</span>=<span class="string">'&#123;&#123;id&#125;&#125;'</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>catchtap正是点击事件属性，名为catchTapMovie，我们需要在调用处index.js中实现这个方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/movies/index/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">   ……</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 点击“电影条目”，携带电影id到“详情”页面</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  catchTapMovie(event) &#123;</span><br><span class="line">    <span class="comment">//打印点击事件封装的数据，查看其结构</span></span><br><span class="line">    <span class="built_in">console</span>.log(event);</span><br><span class="line">    <span class="comment">//获取到movieid的值</span></span><br><span class="line">    <span class="keyword">var</span> id = event.currentTarget.dataset.movieid;</span><br><span class="line">    <span class="comment">//跳转到电影详情页时，将id值赋值给movieId变量传给新页面</span></span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: <span class="string">'detail/detail?movieId='</span> + id</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在点击行为发生后，系统为我们封装了点击控件的一些数据在event中。dataset.movieid便是从data-movieid里获取的值。</p>
<p>注意，无论是data-movieId，还是data-movieid，都用dataset.movieid（小写）接收；无论是data-movie-id或data-movie-ID，都用dataset.movieId（I大写d小写）接收。即不带“-”号的，都会转为小写；带“-”号的多字符，每个“-”号后的首字母变成大写（非首字母变小写），并与其它单词合并在一起。这里是大小写敏感的，变量名不一致将接收不到数据。</p>
<h4 id="详情页"><a href="#详情页" class="headerlink" title="详情页"></a>详情页</h4><p>然后，在电影详情页detail.js的onLoad方法中接收参数，如下（请在movies目录下新建detail目录和detail页面，并在app.json的pages中配置路径）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/movies/detail/detail.js</span></span><br><span class="line"><span class="keyword">var</span> httpUtil = <span class="built_in">require</span>(<span class="string">'../../../utils/httpUtil.js'</span>);</span><br><span class="line"><span class="keyword">var</span> app = getApp();</span><br><span class="line">Page(&#123;</span><br><span class="line">   ……</span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//获取电影信息的接口</span></span><br><span class="line">    <span class="keyword">var</span> url = app.globalData.baseUrl + <span class="string">"/v2/movie/subject/"</span> + options.movieId;</span><br><span class="line">    httpUtil.request(url, <span class="keyword">this</span>.processResult);</span><br><span class="line">  &#125;,</span><br><span class="line"> ……</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>通过options.movieId接收到从首页带过来的movieId变量的值，拼接成接口网址后，请求获取电影信息，并在成功后回调processResult方法。</p>
<p>在此之前，我们先实现电影详情页的页面结构和样式。</p>
<p>detail.wxml代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/detail/detail.wxml--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--导入评分条模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">"../ratingbar/ratingbar.wxml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'detail-container'</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--顶部背景图--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">'banner-image'</span> <span class="attr">src</span>=<span class="string">'&#123;&#123;poster&#125;&#125;'</span> <span class="attr">mode</span>=<span class="string">'aspectFill'</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">'poster'</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;poster&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--电影名称--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'name'</span>&gt;</span>&#123;&#123;chineseTitle&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--电影名称2，通常为外文名--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'name name-en'</span>&gt;</span>&#123;&#123;foreignTitle&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'score-container'</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--电影评分--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'score'</span>&gt;</span>&#123;&#123;score&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'ratingbar-comment'</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--评分星星条--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">"template-ratingbar-stars"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;stars&#125;&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--评价人数--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'comment'</span>&gt;</span>&#123;&#123;comments_count&#125;&#125;人评价<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--电影流派，如剧情、喜剧、古装等--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'text genres'</span>&gt;</span>&#123;&#123;genres&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'text'</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--上映年份--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;year&#125;&#125;年上映<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--国家--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'countries'</span>&gt;</span>&#123;&#123;countries&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'text'</span>&gt;</span>&#123;&#123;directorsAndCasts&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'wish-reviews-container'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'wish-reviews'</span>&gt;</span>想看：&#123;&#123;wish_count&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'wish-reviews'</span>&gt;</span>看过：&#123;&#123;reviews_count&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'summary-title text'</span>&gt;</span>&#123;&#123;chineseTitle&#125;&#125;的剧情简介<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">'text'</span>&gt;</span>&#123;&#123;summary&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>detail.wxss代码如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pages/detail/detail.wxss */</span></span><br><span class="line"><span class="comment">/* 导入评分条模板的wxss */</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">'../ratingbar/ratingbar.wxss'</span>;</span><br><span class="line"><span class="selector-class">.detail-container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.banner-image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">350</span>rpx;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">blur</span>(10rpx);</span><br><span class="line">  <span class="attribute">-webkit-filter</span>:<span class="built_in">blur</span>(10rpx); </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.poster</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">238</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">175</span>rpx;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.name</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">180</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-style</span>: bold;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">215</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.name-en</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">220</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.score-container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">270</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">215</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">60</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.score</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">60</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ratingbar-comment</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">5</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.comment</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5</span>rpx <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">26</span>rpx;</span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-class">.genres</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">60</span>rpx <span class="number">0</span> <span class="number">5</span>rpx <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.countries</span>&#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">14</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wish-reviews-container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">40</span>rpx <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">color</span>: orange;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wish-reviews</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: solid <span class="number">1px</span> orange;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">47%</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">8</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.summary-title</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: grey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在wxml中通过双大括号的方式绑定了一个变量，我们回到detail.js文件中定义这些变量并且实现剩下的业务逻辑。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/movies/detail/detail.js</span></span><br><span class="line">……</span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    chineseTitle: <span class="string">""</span>,<span class="comment">//电影名称（中文）</span></span><br><span class="line">    foreignTitle: <span class="string">""</span>,<span class="comment">//电影名称（外文）</span></span><br><span class="line">    poster: <span class="string">""</span>,<span class="comment">//海报图片地址</span></span><br><span class="line">    score: <span class="string">""</span>,<span class="comment">//数字评分</span></span><br><span class="line">    stars: <span class="string">""</span>,<span class="comment">//星星数</span></span><br><span class="line">    comments_count: <span class="string">""</span>,<span class="comment">//评价人数</span></span><br><span class="line">    genres: <span class="string">""</span>,<span class="comment">//流派</span></span><br><span class="line">    year: <span class="string">""</span>,<span class="comment">//上映年份</span></span><br><span class="line">    countries: <span class="string">""</span>,<span class="comment">//国家</span></span><br><span class="line">    directorsAndCasts: <span class="string">""</span>,<span class="comment">//导演及主演</span></span><br><span class="line">    wish_count: <span class="string">""</span>,<span class="comment">//想看人数</span></span><br><span class="line">    reviews_count: <span class="string">""</span>,<span class="comment">//看过人数</span></span><br><span class="line">    summary: <span class="string">""</span>,<span class="comment">//剧情简介</span></span><br><span class="line">    movie: &#123;&#125; <span class="comment">//电影的整体信息</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ……</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后接着实现刚才网络请求成功后的processResult回调方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/movies/detail/detail.js</span></span><br><span class="line">……</span><br><span class="line">Page(&#123;</span><br><span class="line">   ……</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取电影数据成功的回调函数，在此处理请求到的数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  processResult: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//电影名称，如“神秘巨星 Secret Superstar”</span></span><br><span class="line">    <span class="keyword">var</span> title = result.title;</span><br><span class="line">    <span class="comment">//获取电影名称中的第一个空格位置（如无，返回-1）</span></span><br><span class="line">    <span class="keyword">var</span> index = <span class="keyword">this</span>.getTitleSeparateIndex(title);</span><br><span class="line">    <span class="comment">//截取电影名称中的中文名</span></span><br><span class="line">    <span class="keyword">var</span> chineseTitle = <span class="keyword">this</span>.getChineseTitle(title, index);</span><br><span class="line">    chineseTitle = <span class="keyword">this</span>.substringTitle(chineseTitle, <span class="number">15</span>);</span><br><span class="line">    <span class="comment">//截取电影名称中的外文名</span></span><br><span class="line">    <span class="keyword">var</span> foreignTitle = <span class="keyword">this</span>.getForeignTitle(title, index);</span><br><span class="line">    foreignTitle = <span class="keyword">this</span>.substringTitle(foreignTitle, <span class="number">25</span>);</span><br><span class="line">    foreignTitle = foreignTitle == chineseTitle ? <span class="string">""</span> : foreignTitle;</span><br><span class="line">    <span class="comment">//截取电影国家名</span></span><br><span class="line">    <span class="keyword">var</span> countries = <span class="keyword">this</span>.jointWithSlash(result.countries);</span><br><span class="line">    <span class="comment">//截取电影导演、演员</span></span><br><span class="line">    <span class="keyword">var</span> genresArr = <span class="built_in">String</span>(result.genres).split(<span class="string">","</span>);</span><br><span class="line">    <span class="keyword">var</span> genres = <span class="keyword">this</span>.jointWithSlash(genresArr);</span><br><span class="line">    <span class="keyword">var</span> directorsAndCastsArr = <span class="keyword">this</span>.getCastsNameArr(result.casts);</span><br><span class="line">    <span class="keyword">var</span> directorsAndCasts = <span class="keyword">this</span>.jointWithSlash(directorsAndCastsArr);</span><br><span class="line">    directorsAndCasts = <span class="keyword">this</span>.insertDirectorText(<span class="built_in">String</span>(directorsAndCasts), <span class="string">"(导演)"</span>);</span><br><span class="line">    <span class="comment">//截取电影剧情简介</span></span><br><span class="line">    <span class="keyword">var</span> summary = result.summary == <span class="string">""</span> ? <span class="string">"暂无"</span> : <span class="keyword">this</span>.return2Br(result.summary);</span><br><span class="line">    <span class="comment">//设置新数据并渲染界面</span></span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      chineseTitle: chineseTitle,</span><br><span class="line">      foreignTitle: foreignTitle,</span><br><span class="line">      poster: result.images.large,</span><br><span class="line">      stars: result.rating.stars,</span><br><span class="line">      score: result.rating.average,</span><br><span class="line">      comments_count: result.comments_count,</span><br><span class="line">      genres: genres,</span><br><span class="line">      year: result.year,</span><br><span class="line">      countries: countries,</span><br><span class="line">      directorsAndCasts: directorsAndCasts,</span><br><span class="line">      wish_count: result.wish_count,</span><br><span class="line">      reviews_count: result.reviews_count,</span><br><span class="line">      summary: summary</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//设置导航栏标题为电影中文名称</span></span><br><span class="line">    wx.setNavigationBarTitle(&#123;</span><br><span class="line">      title: chineseTitle,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/* ---------以下为一些字符处理逻辑，可略过--------- */</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取电影名称的分割位置（电影名称通常由中外文组成并以空格分隔）</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getTitleSeparateIndex: <span class="function"><span class="keyword">function</span> (<span class="params">title</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (title == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> title.indexOf(<span class="string">" "</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取电影中文名称/第一个空格前的名称</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getChineseTitle: <span class="function"><span class="keyword">function</span> (<span class="params">title, index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> title.substring(<span class="number">0</span>, index);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取电影外文名称/第一个空格后的名称</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getForeignTitle: <span class="function"><span class="keyword">function</span> (<span class="params">title, index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> length = title.lenght;</span><br><span class="line">    <span class="keyword">return</span> title.substring(index + <span class="number">1</span>, length);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 指定长度，截取电影名称</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  substringTitle: <span class="function"><span class="keyword">function</span> (<span class="params">title, count</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (title.length &lt;= count) &#123;</span><br><span class="line">      <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> title.substring(<span class="number">0</span>, count) + <span class="string">"..."</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用“ / ”拼接数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  jointWithSlash: <span class="function"><span class="keyword">function</span> (<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> array) &#123;</span><br><span class="line">      str += array[i] + <span class="string">" / "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//去除末位的“/ ”符号（斜杠后有个空格，共2位）</span></span><br><span class="line">    <span class="keyword">return</span> str = str.substring(<span class="number">0</span>, str.length - <span class="number">2</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 取出演员的姓名组成一个数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getCastsNameArr: <span class="function"><span class="keyword">function</span> (<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> array) &#123;</span><br><span class="line">      arr[i] = array[i].name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在第一个名字后插入“（导演）”字符</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  insertDirectorText: <span class="function"><span class="keyword">function</span> (<span class="params">str, insertWord</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"insertDirectorText "</span> + str)</span><br><span class="line">    <span class="keyword">var</span> index = str.indexOf(<span class="string">" / "</span>);</span><br><span class="line">    <span class="keyword">var</span> director = str.substring(<span class="number">0</span>, index) + insertWord;</span><br><span class="line">    <span class="keyword">var</span> casts = str.substring(index, str.length);</span><br><span class="line">    <span class="keyword">return</span> director.concat(casts);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 将“\\n”转为“\n”</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  return2Br: <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/\r?\\n/g</span>, <span class="string">"\n"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>按Ctrl+S保存后，快试试首页是否可以点击电影海报到详情页吧。</p>
<h4 id="更多页"><a href="#更多页" class="headerlink" title="更多页"></a>更多页</h4><p>依葫芦画瓢，来实现首页点击“更多”按钮到更多页。首先在movies目录下新建more目录和页面，并在app.json的pages中配置页面路径。然后在block.wxml中找到“更多”按钮的点击事件名称及数据属性名。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--更多和右箭头按钮--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'block-more'</span> <span class="attr">catchtap</span>=<span class="string">'catchMore'</span> <span class="attr">data-title</span>=<span class="string">'&#123;&#123;blockTitle&#125;&#125;'</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过title接收区块名称，点击事件为catchMore。在调用处index.js中实现吧。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/movies/index/index.js</span></span><br><span class="line">……</span><br><span class="line">Page(&#123;</span><br><span class="line">  ……</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 点击“更多”按钮，携带类别信息到“更多”页面</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  catchMore: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event)</span><br><span class="line">    <span class="comment">//获得区块的标题</span></span><br><span class="line">    <span class="keyword">var</span> title = event.currentTarget.dataset.title</span><br><span class="line">    <span class="comment">//跳转到“更多页”，将区块标题通过category携带过去</span></span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: <span class="string">'more/more?category='</span> + title</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在more.js的onLoad方法中接收传入的区块标题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  ……</span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> category = options.category;</span><br><span class="line">    <span class="keyword">var</span> url = app.globalData.baseUrl;</span><br><span class="line">    <span class="comment">//根据区块标题，设置接口为对应的请求网址</span></span><br><span class="line">    <span class="keyword">switch</span>(category)&#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"正在热映"</span>:</span><br><span class="line">        url += <span class="string">"/v2/movie/in_theaters"</span>; </span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"即将上映"</span>:</span><br><span class="line">        url += <span class="string">"/v2/movie/coming_soon"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"排行榜"</span>:</span><br><span class="line">        url += <span class="string">"/v2/movie/top250"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ……</span><br><span class="line">  &#125;,</span><br><span class="line">  ……</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>先来看看更多页more.wxml的页面结构。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/movies/more/more.wxml--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--导入电影海报模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">"../poster/poster.wxml"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--竖向的scroll-view，有个滑到底部监听事件loadMore--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">'more-container'</span> <span class="attr">scroll-y</span>=<span class="string">"&#123;&#123;true&#125;&#125;"</span> <span class="attr">bindscrolltolower</span>=<span class="string">"loadMore"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--for循环取出电影信息，变成海报形式排列--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;allMovies&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"movie"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'more-poster'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">"template-poster"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123;...movie&#125;&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>更多页more.wxss的样式代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pages/movies/more/more.wxss */</span></span><br><span class="line"><span class="comment">/* 导入电影海报模板wxss */</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"../poster/poster.wxss"</span>;</span><br><span class="line"><span class="selector-class">.more-container</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20</span>rpx <span class="number">0</span>; </span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1300</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.more-poster</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span> <span class="number">0</span> <span class="number">33</span>rpx; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和首页类似，这里使用了一个控件，不过是竖向的，有一个名为loadMore的bindscrolltolower事件（滑动到底部），当页面滑动到底部时，将触发此事件，我们在js的这个事件里实现“滑到底部加载更多”的逻辑。（页面还有“上拉加载更多”事件，也可试试用这个方法实现）</p>
<p>在more.js代码中，有如下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/movies/more/more.js</span></span><br><span class="line"><span class="keyword">var</span> httpUtil = <span class="built_in">require</span>(<span class="string">'../../../utils/httpUtil.js'</span>);</span><br><span class="line"><span class="keyword">var</span> stringUtil = <span class="built_in">require</span>(<span class="string">'../../../utils/stringUtil.js'</span>);</span><br><span class="line"><span class="keyword">var</span> app = getApp();</span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    navigationBarTitle: <span class="string">""</span>,<span class="comment">//页面标题</span></span><br><span class="line">    requestUrl: <span class="string">""</span>,<span class="comment">//请求的网址</span></span><br><span class="line">    allMovies: &#123;&#125;,<span class="comment">//全部电影信息</span></span><br><span class="line">    totalCount: <span class="number">0</span>,<span class="comment">//已请求的电影数量</span></span><br><span class="line">    requestCount: <span class="number">20</span> <span class="comment">//一次请求多少条</span></span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> category = options.category;</span><br><span class="line">    <span class="keyword">var</span> url = app.globalData.baseUrl;</span><br><span class="line">    <span class="comment">//根据区块标题，设置接口为对应的请求网址</span></span><br><span class="line">    <span class="keyword">switch</span> (category) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"正在热映"</span>:</span><br><span class="line">        url += <span class="string">"/v2/movie/in_theaters"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"即将上映"</span>:</span><br><span class="line">        url += <span class="string">"/v2/movie/coming_soon"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"排行榜"</span>:</span><br><span class="line">        url += <span class="string">"/v2/movie/top250"</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将区块标题存储起来，在onReady()中设为导航栏标题</span></span><br><span class="line">    <span class="keyword">this</span>.data.navigationBarTitle = category;</span><br><span class="line">    <span class="comment">//将区块对应的接口网址存储起来（注意不含start=?&amp;count=?字符）</span></span><br><span class="line">    <span class="keyword">this</span>.data.requestUrl = url;</span><br><span class="line">    <span class="comment">//请求数据</span></span><br><span class="line">    httpUtil.request(url, <span class="keyword">this</span>.processResult);</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取电影数据的success回调函数，在此处理请求到的数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  processResult: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//打印请求的数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(result))</span><br><span class="line">    <span class="comment">//处理电影名称过长的问题</span></span><br><span class="line">    stringUtil.processTitle(result.subjects, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">var</span> tempMovies = &#123;&#125;;</span><br><span class="line">    <span class="comment">//如果已展示的电影数量大于0，说明是滑到底加载更多，需将后续数据与已有数据拼接；否则是进入页面（或下拉刷新）场景，直接赋值即可。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.data.totalCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      tempMovies = <span class="keyword">this</span>.data.allMovies.concat(result.subjects);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      tempMovies = result.subjects;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//原本已加载的电影总数+本次请求成功的电影数</span></span><br><span class="line">    <span class="keyword">this</span>.data.totalCount += <span class="keyword">this</span>.data.requestCount;</span><br><span class="line">    <span class="comment">//重新渲染页面数据</span></span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      allMovies: tempMovies</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 滑动到底部加载更多</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  loadMore: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="keyword">this</span>.data.requestUrl + <span class="string">"?start="</span> + <span class="keyword">this</span>.data.totalCount + <span class="string">"&amp;count="</span> + <span class="keyword">this</span>.data.requestCount;</span><br><span class="line">    httpUtil.request(url, <span class="keyword">this</span>.processResult);</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//设置页面导航栏标题</span></span><br><span class="line">    <span class="comment">//官方提示此方法在onReady之后的方法调用</span></span><br><span class="line">    <span class="comment">//意味着不要在onLoad里调用</span></span><br><span class="line">    wx.setNavigationBarTitle(&#123;</span><br><span class="line">      title: <span class="keyword">this</span>.data.navigationBarTitle</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>别忘了，此页面的海报也是可以点击进入到电影详情页的，很简单，和主页一样，在more.js里实现点击事件，携带movieId到detail即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点击“电影条目”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">catchTapMovie(event) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event);</span><br><span class="line">  <span class="keyword">var</span> movieId = event.currentTarget.dataset.movieid;</span><br><span class="line">  wx.navigateTo(&#123;</span><br><span class="line">    url: <span class="string">'../detail/detail?movieId='</span> + movieId</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>到这里，我们边做边学了小程序开发最基础的一些入门知识，如页面配置、tabBar配置、模板页面、点击事件、网络请求与回调等，并能成功地独立完成一个较为简单的作品。</p>
<h3 id="扩展知识"><a href="#扩展知识" class="headerlink" title="扩展知识"></a>扩展知识</h3><p>控件的点击事件有2种，除了文中出现的catchtap，还有bindtap事件。这两种事件的使用场景有什么区别呢？我们来看个小例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">"outerTap"</span> <span class="attr">style</span>=<span class="string">"width:100px;height:100px;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">catchtap</span>=<span class="string">"innerTap"</span> <span class="attr">style</span>=<span class="string">"width:50px;height:50px;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里定义了两个嵌套的控件，内部使用了catchtap，外部则使用了bindtap。当我们只点击内部控件时，只会触发innerTap事件，外部控件的outerTap事件是不会触发的。而将catchtap改为bindtap后，外部控件的outerTap事件也能够触发。可见，bindtap不会阻止事件向外层（父层）传达，而catchtap则不同，会将事件捕获在本层，不再向外传达。</p>
<h3 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h3><p>也许你注意到了，在控制台总是在有wx:for循环的地方会出现下图的提示，尝试去搜索下答案吧？</p>
<p><img src="边做边学入门微信小程序之仿豆瓣评分：下/miniprogram_03.jpg" alt="img"></p>
<p><img src="边做边学入门微信小程序之仿豆瓣评分：下/mediaplatform.jpg" alt="img"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/小程序/" rel="tag"># 小程序</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/03/图解排序算法：计数排序/" rel="next" title="图解排序算法：计数排序">
                <i class="fa fa-chevron-left"></i> 图解排序算法：计数排序
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/23/边做边学入门微信小程序之仿豆瓣评分：上/" rel="prev" title="边做边学入门微信小程序之仿豆瓣评分（上）">
                边做边学入门微信小程序之仿豆瓣评分（上） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">徐纯文</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#主页"><span class="nav-number">1.</span> <span class="nav-text">主页</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#网络请求"><span class="nav-number">1.1.</span> <span class="nav-text">网络请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#逻辑实现"><span class="nav-number">1.2.</span> <span class="nav-text">逻辑实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#setData"><span class="nav-number">1.3.</span> <span class="nav-text">setData</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#点击事件"><span class="nav-number">1.4.</span> <span class="nav-text">点击事件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#详情页"><span class="nav-number">2.</span> <span class="nav-text">详情页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更多页"><span class="nav-number">3.</span> <span class="nav-text">更多页</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#扩展知识"><span class="nav-number"></span> <span class="nav-text">扩展知识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#思考题"><span class="nav-number"></span> <span class="nav-text">思考题</span></a></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">徐纯文</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
